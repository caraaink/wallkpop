<!DOCTYPE html>
<html>
<head>
  <title>WallKpop Admin Panel</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .section { margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input[type="text"], textarea { width: 100%; padding: 8px; font-size: 16px; }
    textarea { height: 100px; resize: vertical; }
    input[type="submit"], button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; }
    input[type="submit"]:hover, button:hover { background: #0056b3; }
    details { margin-bottom: 10px; }
    summary { cursor: pointer; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
  <script>
    async function fetchConfigAndPosts() {
      const response = await fetch('/api/config');
      const { config, posts } = await response.json();
      document.getElementById('meta').value = config.meta || '';
      document.getElementById('header').value = config.header || '';
      document.getElementById('index').value = config.index || '';
      document.getElementById('footer').value = config.footer || '';
      document.getElementById('css').value = config.css || '';
      document.getElementById('sitemap').value = config.sitemap || '';
      document.getElementById('robots').value = config.robots || '';
      const tbody = document.getElementById('posts-table').querySelector('tbody');
      tbody.innerHTML = posts.map(p => `
        <tr>
          <td>${p.id}</td>
          <td>${p.artist}</td>
          <td>${p.title}</td>
          <td>${p.year}</td>
          <td>
            <button onclick="editPost(${p.id}, '${p.artist}', '${p.title}', '${p.year}')">Edit</button>
            <form action="/panel" method="POST" style="display:inline;">
              <input type="hidden" name="action" value="delete_post">
              <input type="hidden" name="post_id" value="${p.id}">
              <button type="submit">Delete</button>
            </form>
          </td>
        </tr>
      `).join('');
    }
    function editPost(id, artist, title, year) {
      document.getElementById('post-action').value = 'edit_post';
      document.getElementById('post-id').value = id;
      document.getElementById('var-artist').value = artist;
      document.getElementById('var-title').value = title;
      document.getElementById('var-year').value = year;
      document.getElementById('create-post-title').textContent = 'Edit Post';
    }
    window.onload = fetchConfigAndPosts;
  </script>
</head>
<body>
  <h1>WallKpop Admin Panel</h1>
  <div class="section">
    <details open>
      <summary id="create-post-title">Create New Post</summary>
      <form action="/panel" method="POST">
        <input type="hidden" name="action" id="post-action" value="create_post">
        <input type="hidden" name="post_id" id="post-id">
        <div class="form-group">
          <label for="var-artist">Artist</label>
          <input type="text" name="var-artist" id="var-artist" autocomplete="off" required>
        </div>
        <div class="form-group">
          <label for="var-title">Title</label>
          <input type="text" name="var-title" id="var-title" autocomplete="off" required>
        </div>
        <div class="form-group">
          <label for="var-year">Year</label>
          <input type="text" name="var-year" id="var-year" autocomplete="off" required>
        </div>
        <input type="submit" value="Submit">
      </form>
    </details>
  </div>
  <div class="section">
    <details>
      <summary>Manage Posts</summary>
      <table id="posts-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Artist</th>
            <th>Title</th>
            <th>Year</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </details>
  </div>
  <div class="section">
    <details>
      <summary>Edit Site Configuration</summary>
      <form action="/panel" method="POST">
        <input type="hidden" name="action" value="save_config">
        <div class="form-group">
          <label for="meta">Meta Tags (HTML)</label>
          <textarea name="meta" id="meta"></textarea>
        </div>
        <div class="form-group">
          <label for="header">Header (HTML)</label>
          <textarea name="header" id="header"></textarea>
        </div>
        <div class="form-group">
          <label for="index">Index Content (HTML)</label>
          <textarea name="index" id="index"></textarea>
        </div>
        <div class="form-group">
          <label for="footer">Footer (HTML)</label>
          <textarea name="footer" id="footer"></textarea>
        </div>
        <div class="form-group">
          <label for="css">CSS</label>
          <textarea name="css" id="css"></textarea>
        </div>
        <div class="form-group">
          <label for="sitemap">Sitemap (XML)</label>
          <textarea name="sitemap" id="sitemap"></textarea>
        </div>
        <div class="form-group">
          <label for="robots">robots.txt</label>
          <textarea name="robots" id="robots"></textarea>
        </div>
        <input type="submit" value="Save Configuration">
      </form>
    </details>
  </div>
  <p><a href="/">Back to Home</a></p>
</body>
</html>
